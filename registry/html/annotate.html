<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>@URL_PATH@</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"> </script>
    <script src="/annotator-full.min.js"> </script>
    <link rel="stylesheet" href="/annotator.min.css">

    <script type="application/javascript">

jQuery(document).ready(function () {
    var urlPath = "@URL_PATH@";

    jQuery.get(urlPath, function (data) {

        /*-
         * XXX Remove many tags (head, script, iframe, noscript) to make
         * sure that we only load the bare minimum of the post.
         *
         * We cannot load JavaScript because it may conflict with the jQuery
         * that we use; we cannot load the CSSs because they may be over http,
         * and so they won't load anyway.
         *
         * To this end, use the following StackOverflow recipe:
         *
         *     http://stackoverflow.com/questions/6659351
         */

        data = data.replace(
            /<head\b[^<]*(?:(?!<\/head>)<[^<]*)*<\/head>/gi,
            "<head><title>@URL_PATH@</title></head>");

        data = data.replace(
            /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, "");

        data = data.replace(
            /<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi, "");

        data = data.replace(
            /<noscript\b[^<]*(?:(?!<\/noscript>)<[^<]*)*<\/noscript>/gi, "");

        // XXX Make sure we only load stuff from https
        data = data.replace(/http:/g, "https:");

        jQuery("#content").html(data);

        var content = jQuery("#content").annotator();
        content.annotator("addPlugin", "Store", {
            "prefix": "/annotator",
            annotationData: {
                "uri": urlPath
            },
            loadFromSearch: {
                "limit": 0,
                "uri": urlPath
            }
	});

    });
});

    </script>
  </head>
  <body>
    <div id="content"></div>
  </body>
</html>
